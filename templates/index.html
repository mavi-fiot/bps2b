<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–Ü–°–ï–ì ‚Äî –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</title>
  <script src="https://cdn.jsdelivr.net/npm/@noble/curves@1.4.0/ed25519.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f5f7fa;
      color: #333;
      max-width: 800px;
      margin: auto;
      padding: 2rem;
    }
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    input, button, select {
      font-size: 1rem;
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background-color: #2d6cdf;
      color: white;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #1a4fbf;
    }
    pre {
      background: #f0f2f4;
      padding: 10px;
      border: 1px solid #ccc;
      font-size: 0.95em;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h1>–Ü–°–ï–ì ‚Äî –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–µ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</h1>

<div class="card">
  <label>üßç –í–≤–µ–¥—ñ—Ç—å –≤–∞—à ID:</label>
  <input id="voterId" placeholder="demo-voter">

  <label>üó≥Ô∏è –í–≤–µ–¥—ñ—Ç—å ID –±—é–ª–µ—Ç–µ–Ω—è:</label>
  <input id="ballotId" placeholder="–≤—Å—Ç–∞–≤ ID –∑ /generate_ballots">

  <label>üó£Ô∏è –û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç:</label>
  <select id="choice">
    <option value="–∑–∞">‚úÖ –ó–∞</option>
    <option value="–ø—Ä–æ—Ç–∏">‚ùå –ü—Ä–æ—Ç–∏</option>
    <option value="—É—Ç—Ä–∏–º–∞–≤—Å—è">‚ûñ –£—Ç—Ä–∏–º–∞–≤—Å—è</option>
  </select>

  <label>‚úçÔ∏è –ü—ñ–¥–ø–∏—Å X:</label>
  <input id="sigX">
  <label>‚úçÔ∏è –ü—ñ–¥–ø–∏—Å Y:</label>
  <input id="sigY">

  <label>üîë –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á X:</label>
  <input id="pubX">
  <label>üîë –ü—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á Y:</label>
  <input id="pubY">

  <button onclick="generateKeys()">üîë –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å —Ç–∞ –∫–ª—é—á</button>
  <button onclick="sendVote()">üì® –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≥–æ–ª–æ—Å</button>
</div>

<pre id="result">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è...</pre>

<script>
  const ed = window.nobleCurves.ed25519.ED25519;

  function generateKeys() {
    const priv = ed.utils.randomPrivateKey(); // Uint8Array
    const privBigInt = BigInt('0x' + Buffer.from(priv).toString('hex')) % ed.CURVE.n;
    const pub = ed.getPublicKey(privBigInt);

    const pubPoint = ed.ExtendedPoint.fromHex(pub);
    const sigPoint = pubPoint.multiply(privBigInt);

    document.getElementById("pubX").value = pubPoint.x.toString();
    document.getElementById("pubY").value = pubPoint.y.toString();
    document.getElementById("sigX").value = sigPoint.x.toString();
    document.getElementById("sigY").value = sigPoint.y.toString();

    console.log("üóùÔ∏è –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á (hex):", Buffer.from(priv).toString("hex"));
  }

  async function sendVote() {
    const payload = {
      voter_id: document.getElementById("voterId").value.trim(),
      ballot_id: document.getElementById("ballotId").value.trim(),
      choice: document.getElementById("choice").value,
      signature: {
        x: document.getElementById("sigX").value,
        y: document.getElementById("sigY").value
      },
      public_key: {
        x: document.getElementById("pubX").value,
        y: document.getElementById("pubY").value
      }
    };

    const res = await fetch("https://bps-iseg-api.onrender.com/secure/vote", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    document.getElementById("result").textContent = JSON.stringify(data, null, 2);
  }
</script>

</body>
</html>
